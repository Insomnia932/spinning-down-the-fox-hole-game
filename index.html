<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Spinning Down the Fox Hole - Playable</title>
<link href="https://fonts.googleapis.com/css2?family=Great+Vibes&display=swap" rel="stylesheet">
<style>
body { margin:0; overflow:hidden; font-family:Arial,sans-serif; background:#020024; }
canvas { display:block; position:absolute; top:0; left:0; z-index:1; }

.menu { 
  position:absolute; top:0; left:0; width:100%; height:100%;
  background:#000; display:flex; flex-direction:column; align-items:center; justify-content:center;
  z-index:10; transition:opacity 0.3s; 
}
.menu.hidden { opacity:0; pointer-events:none; }
.menu-title { display:flex; align-items:center; justify-content:center; margin-bottom:25px; }
.menu-title .title-block { display:flex; flex-direction:column; align-items:center; }
.menu-title .title-block h1 { font-family: 'Great Vibes', cursive; color: gold; font-size:48px; margin:0; text-align:center; line-height:1; }
.menu-title img { width:150px; height:auto; }
.menu-title .left { transform:scaleX(-1); } 
.menu button { font-size:26px; padding:12px 30px; margin:8px; border:none; border-radius:10px; background:linear-gradient(180deg,#000,#222); color: gold; cursor:pointer; width:220px; transition:0.3s; }
.menu button:hover { background:linear-gradient(180deg,#333,#555); }

#pauseBtn, #exitFullscreenBtn { position:absolute; top:20px; right:20px; padding:10px 20px; font-size:20px; border:none; border-radius:8px; z-index:5; cursor:pointer; display:none; }
#pauseBtn { background:rgba(255,123,0,0.7); color:white; }
#exitFullscreenBtn { background:#222; color:gold; font-size:24px; }
</style>
</head>
<body>

<div class="menu" id="mainMenu">
  <div class="menu-title">
    <img src="https://i.ibb.co/p6Lt7nNd/e2eb6366-b194-476b-a714-99a2449d34ba.png" class="left">
    <div class="title-block">
      <h1>Spinning Down</h1>
      <h1>The</h1>
      <h1>Fox Hole</h1>
    </div>
    <img src="https://i.ibb.co/p6Lt7nNd/e2eb6366-b194-476b-a714-99a2449d34ba.png" class="right">
  </div>
  <h2 id="bestScoreText">Top Score: 0</h2>
  <button id="playBtn">Play</button>
  <button id="continueBtn" style="display:none;">Continue</button>
  <button id="highScoresBtn">High Scores</button>
  <button id="resetHighBtn">Reset High Scores</button>
  <button id="fullscreenBtn">Fullscreen</button>
</div>

<div class="menu hidden" id="pauseMenu">
  <h1>Paused</h1>
  <button id="continueGameBtn">Continue</button>
  <button id="restartBtn">Restart</button>
  <button id="menuBtn">Main Menu</button>
</div>

<button id="pauseBtn">Pause</button>
<button id="exitFullscreenBtn">X</button>
<canvas id="gameCanvas"></canvas>

<script>
// ---------------------- CANVAS ----------------------
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

// ---------------------- IMAGES ----------------------
const foxImg = new Image(); foxImg.src = "https://i.ibb.co/p6Lt7nNd/e2eb6366-b194-476b-a714-99a2449d34ba.png";
const obstacleImg = new Image(); obstacleImg.src = "https://i.ibb.co/SwGYdXP8/file-00000000fa906206a0873428ec82c8a9.png";
const heartImg = new Image(); heartImg.src = "https://i.ibb.co/0jsR2xyJ/sketch1760895249408.png";

// ---------------------- GAME VARIABLES ----------------------
let foxWidth=120, foxHeight=120, foxX=50, foxY=canvas.height-foxHeight-50;
let velocityY=0, gravity=0.7, groundHeight=50;
let obstacles=[], fireballs=[];
let gameSpeed=5, score=0, lives=3;
let jumpCount=0, maxJumps=3;
let isPaused=true, isGameOver=false;

// ---------------------- TOP 10 HIGH SCORES ----------------------
let topScores = JSON.parse(localStorage.getItem("foxTopScores")) || [];
let bestScoreText = document.getElementById("bestScoreText");
bestScoreText.textContent = topScores.length > 0 ? `Top Score: ${topScores[0].score}` : "Top Score: 0";

// ---------------------- FOREST & BACKGROUND ----------------------
let forestLayers = [
  {color:"#0b0f3a", speed:0.5, height:200}, // dark navy
  {color:"#2e004f", speed:1, height:180},   // dark purple
  {color:"#034d03", speed:1.5, height:150}  // dark green
];

let forestPositions = forestLayers.map(layer => {
  let positions = [];
  for (let x = 0; x < canvas.width + 50; x += 50) {
    let treeHeight = layer.height + Math.random() * 50;
    positions.push({x:x, height:treeHeight});
  }
  return positions;
});

let mountains = [
  {color:"#1b1b1b", speed:0.2, peaks:[], baseHeight:300},
  {color:"#2c2c2c", speed:0.35, peaks:[], baseHeight:220}
];
mountains.forEach(layer=>{
  for(let x=0;x<canvas.width+100;x+=50){
    layer.peaks.push({x:x, height:layer.baseHeight + Math.random()*150});
  }
});
let stars=[]; 
for(let i=0;i<100;i++) stars.push({x:Math.random()*canvas.width, y:Math.random()*canvas.height*0.5, size:Math.random()*2+1});
let moon={x:canvas.width*0.8, y:canvas.height*0.15, radius:60, glow:25};

// ---------------------- INPUT ----------------------
function jump(){ if(isPaused||isGameOver) return; if(jumpCount<maxJumps){ velocityY=-16; jumpCount++; } }
document.addEventListener("keydown", e=>{ if(e.code==="Space") jump(); });
document.addEventListener("touchstart", jump);

// ---------------------- FULLSCREEN ----------------------
const fullscreenBtn = document.getElementById("fullscreenBtn");
const exitFullscreenBtn = document.getElementById("exitFullscreenBtn");
fullscreenBtn.onclick = ()=>{
  if(!document.fullscreenElement){
    document.documentElement.requestFullscreen().then(()=>{ exitFullscreenBtn.style.display="block"; });
  }
};
exitFullscreenBtn.onclick = ()=>{
  if(document.fullscreenElement) document.exitFullscreen();
};

// ---------------------- MENU BUTTONS ----------------------
const mainMenu=document.getElementById("mainMenu");
const pauseMenu=document.getElementById("pauseMenu");
const playBtn=document.getElementById("playBtn");
const continueBtn=document.getElementById("continueBtn");
const highScoresBtn=document.getElementById("highScoresBtn");
const resetHighBtn=document.getElementById("resetHighBtn");
const continueGameBtn=document.getElementById("continueGameBtn");
const restartBtn=document.getElementById("restartBtn");
const menuBtn=document.getElementById("menuBtn");
const pauseBtn=document.getElementById("pauseBtn");

playBtn.onclick=startGame;
continueBtn.onclick=resumeGame;
restartBtn.onclick=restartGame;
menuBtn.onclick=returnToMenu;

// ---------------------- HIGH SCORES BUTTON ----------------------
highScoresBtn.onclick = () => {
    if(topScores.length===0){ alert("No high scores yet!"); return; }
    let message = "ðŸ† Top 10 High Scores ðŸ†\n\n";
    topScores.forEach((entry,index)=>{ message += `${index+1}. ${entry.name} - ${entry.score}\n`; });
    alert(message);
};

// ---------------------- RESET HIGH SCORES BUTTON ----------------------
resetHighBtn.onclick = () => {
    if(confirm("Reset all top scores?")){ topScores=[]; localStorage.removeItem("foxTopScores"); bestScoreText.textContent="Top Score: 0"; alert("Top scores reset!"); }
};

pauseBtn.onclick=()=>{ if(!isPaused&&!isGameOver) pauseGame(); };
continueGameBtn.onclick=resumeGame;

// ---------------------- SPAWN ----------------------
function spawnObstacle() {
    let baseSize = 80 + Math.random()*40;
    obstacles.push({x:canvas.width+50, y:canvas.height-groundHeight-baseSize, width:baseSize*0.7, height:baseSize, scored:false, hit:false});
}

function spawnFireball() {
    let fireballY = canvas.height-groundHeight-70-Math.random()*30;
    fireballs.push({x:canvas.width+50, y:fireballY, radius:20, passed:false, hit:false});
}

// ---------------------- UPDATE ----------------------
function updateObstacles() {
    for(let obs of obstacles){ 
        obs.x -= gameSpeed;
        if(!obs.scored && obs.x + obs.width < foxX){ obs.scored=true; score+=1; }
    }
    obstacles = obstacles.filter(obs=>obs.x+obs.width>0);
    if(obstacles.length===0 || obstacles[obstacles.length-1].x<canvas.width-400) spawnObstacle();
}

function updateFireballs() {
    for(let f of fireballs){ 
        f.x -= gameSpeed+1;
        if(!f.passed && f.x+f.radius*2 < foxX){ f.passed=true; score+=5; }
    }
    fireballs = fireballs.filter(f=>f.x+f.radius*2>0);
    if(fireballs.length===0 && Math.random()<0.02) spawnFireball();
}

// ---------------------- COLLISIONS ----------------------
function detectCollisions() {
    for(let obs of obstacles){
        if(!obs.hit && foxX+foxWidth*0.6 > obs.x && foxX < obs.x + obs.width*0.6 && foxY+foxHeight > obs.y && foxY < obs.y + obs.height){
            lives--; obs.hit=true;
        }
    }
    for(let f of fireballs){
        if(!f.hit && foxX+foxWidth*0.6 > f.x && foxX < f.x + f.radius*2 && foxY+foxHeight > f.y && foxY < f.y + f.radius*2){
            lives--; f.hit=true;
        }
    }
    if(lives <= 0) gameOver();
}

// ---------------------- DRAW FUNCTIONS ----------------------
function drawObstacles(){ for(let obs of obstacles){ ctx.drawImage(obstacleImg, obs.x, obs.y, obs.width, obs.height); } }
function drawFireballs(){ 
    for(let f of fireballs){ 
        ctx.save();
        let gradient = ctx.createRadialGradient(f.x+f.radius,f.y+f.radius,5,f.x+f.radius,f.y+f.radius,f.radius);
        gradient.addColorStop(0,"orange"); gradient.addColorStop(1,"rgba(255,0,0,0.5)");
        ctx.fillStyle = gradient; 
        ctx.beginPath(); 
        ctx.arc(f.x+f.radius,f.y+f.radius,f.radius,0,Math.PI*2); 
        ctx.fill(); 
        ctx.restore(); 
    } 
}

function drawHUD(){ 
    ctx.fillStyle="white"; ctx.font="24px Arial"; 
    ctx.fillText("Score: "+score,20,40);
    ctx.fillText("Top Score: "+(topScores[0]?.score||0),20,70);
    for(let i=0;i<lives;i++){ ctx.drawImage(heartImg,20+i*45,100,40,40); }
}

// ---------------------- DRAW BACKGROUND ----------------------
function drawBackground(){
    ctx.fillStyle="#020024"; ctx.fillRect(0,0,canvas.width,canvas.height);

    for(let s of stars){ ctx.fillStyle="white"; ctx.beginPath(); ctx.arc(s.x,s.y,s.size,0,Math.PI*2); ctx.fill(); s.x-=0.2; if(s.x<0) s.x=canvas.width; }

    ctx.save();
    let gradient = ctx.createRadialGradient(moon.x, moon.y, moon.radius-15, moon.x, moon.y, moon.radius+moon.glow);
    gradient.addColorStop(0,"rgba(255,255,230,0.9)");
    gradient.addColorStop(1,"rgba(200,180,255,0.3)");
    ctx.fillStyle = gradient; 
    ctx.beginPath(); 
    ctx.arc(moon.x,moon.y,moon.radius+moon.glow,0,Math.PI*2); 
    ctx.fill();
    ctx.restore();

    mountains.forEach(layer=>{
        ctx.fillStyle=layer.color; 
        ctx.beginPath(); ctx.moveTo(0,canvas.height);
        layer.peaks.forEach(p=>{ p.x-=layer.speed; if(p.x<-50)p.x=canvas.width+Math.random()*100; ctx.lineTo(p.x,canvas.height-p.height); });
        ctx.lineTo(canvas.width,canvas.height); ctx.closePath(); ctx.fill();
    });

    forestLayers.forEach((layer, li)=>{
        forestPositions[li].forEach(tree=>{
            tree.x -= layer.speed; if(tree.x<-50) tree.x=canvas.width;
            ctx.fillStyle="#1a1a1a"; ctx.fillRect(tree.x, canvas.height-groundHeight-tree.height, 10, tree.height);
        });
    });

    ctx.fillStyle="#111"; ctx.fillRect(0,canvas.height-groundHeight,canvas.width,groundHeight);
}

// ---------------------- GAME LOOP ----------------------
function gameLoop(){
    drawBackground();
    if(!isPaused && !isGameOver){
        velocityY+=gravity; foxY+=velocityY;
        if(foxY+foxHeight>=canvas.height-groundHeight){ foxY=canvas.height-foxHeight-groundHeight; velocityY=0; jumpCount=0; }

        updateObstacles();
        updateFireballs();
        detectCollisions();

        if(score<150) gameSpeed=5; else if(score<300) gameSpeed=7; else gameSpeed=9;
    }
    ctx.drawImage(foxImg,foxX,foxY,foxWidth,foxHeight);
    drawObstacles();
    drawFireballs();
    drawHUD();
    requestAnimationFrame(gameLoop);
}
gameLoop();

// ---------------------- GAME FUNCTIONS ----------------------
function startGame(){ mainMenu.classList.add("hidden"); continueBtn.style.display="block"; isPaused=false; isGameOver=false; pauseBtn.style.display="block"; resetGame(); spawnObstacle(); spawnFireball(); }
function pauseGame(){ isPaused=true; pauseMenu.classList.remove("hidden"); }
function resumeGame(){ isPaused=false; pauseMenu.classList.add("hidden"); }
function restartGame(){ pauseMenu.classList.add("hidden"); isPaused=false; isGameOver=false; resetGame(); spawnObstacle(); spawnFireball(); }
function returnToMenu(){ isPaused=true; pauseMenu.classList.add("hidden"); mainMenu.classList.remove("hidden"); pauseBtn.style.display="none"; bestScoreText.textContent=`Top Score: ${topScores[0]?.score||0}`; }
function resetGame(){ foxY=canvas.height-foxHeight-groundHeight; velocityY=0; obstacles=[]; fireballs=[]; score=0; lives=3; jumpCount=0; gameSpeed=5; }

// ---------------------- GAME OVER ----------------------
function gameOver(){
    isGameOver=true; isPaused=true; pauseBtn.style.display="none";
    let playerName = prompt("Enter your name:","Anonymous") || "Anonymous";
    topScores.push({name:playerName, score:score});
    topScores.sort((a,b)=>b.score-a.score);
    if(topScores.length>10) topScores.pop();
    localStorage.setItem("foxTopScores", JSON.stringify(topScores));
    alert(`Game Over! Score: ${score}\nTop Score: ${topScores[0].score} by ${topScores[0].name}`);
    returnToMenu();
}
</script>
</body>
</html>
